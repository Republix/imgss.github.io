parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"zfSF":[function(require,module,exports) {
function t(t,s){return n(t)||o(t,s)||i()}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function o(t,i){var o=[],n=!0,s=!1,e=void 0;try{for(var h,r=t[Symbol.iterator]();!(n=(h=r.next()).done)&&(o.push(h.value),!i||o.length!==i);n=!0);}catch(a){s=!0,e=a}finally{try{n||null==r.return||r.return()}finally{if(s)throw e}}return o}function n(t){if(Array.isArray(t))return t}var s;s=function(){function i(t,i,o){this.gridData=t,this.targetPosition=i,this.foundCallback=o,this.width=this.gridData[0].length,this.height=this.gridData.length}return i.prototype.parseGridData=function(){var t,i,o,n,s,e,h,r,a,d,u;for(t=[],e=h=0,a=(u=this.gridData).length;h<a;e=++h)for(s=r=0,d=(n=u[e]).length;r<d;s=++r)o={open:!n[s],visited:!1,index:i=e*this.width+s,x:s,y:e},t[i]=o;return t},i.prototype.beginFill=function(t){var i=t.x,o=t.y;for(i/=window.CELL_W,o/=window.CELL_W,this.startPosition=[i,o],this.reset(),this.closeNode(i,o),this.addNeighbors(i,o);!this.isFinished;)this.nextStep()},i.prototype.findSteps=function(i,o){var n=t(i,2),s=n[0],e=n[1];for(this.startPosition=i,this.reset(),this.closeNode(s,e),this.addNeighbors(s,e);o--;)this.nextStep()},i.prototype.nextStep=function(){var t,i,o;if(0!==this.open.length)return t=(o=this.iToC(this.open.shift()))[0],i=o[1],this.closeNode(t,i),this.addNeighbors(t,i);this.isFinished=!0},i.prototype.addNeighbors=function(t,i){var o;o=this.data[this.cToI(t,i)].index,this.addOpen(t+1,i,o),t-1>=0&&this.addOpen(t-1,i,o),this.addOpen(t,i+1,o),i-1>=0&&this.addOpen(t,i-1,o)},i.prototype.addOpen=function(t,i,o){var n,s,e,h,r;if(!(t<0||t>this.width-1||i<0||i>this.height-1))return n=this.cToI(t,i),(s=this.data[n]).open&&(this.open.push(n),s.fromIndex=o,s.open=!1,s.visited=!0),e=(r=this.targetPosition)[0],h=r[1],t===e&&i===h?this.targetFound():void 0},i.prototype.closeNode=function(t,i){var o;o=this.data[this.cToI(t,i)];try{o.open=!1}catch(n){console.log(this),console.log(t,i)}},i.prototype.targetFound=function(){var t;for(this.isFinished=!0,this.solutionPath=[],this.solutionPath.push(this.targetPosition),t=[];this.walkSolution();)t.push(!0);return t},i.prototype.pathFound=function(){var t;t=this.solutionPath.reverse(),this.path=t.slice(1),this.foundCallback&&this.foundCallback(t)},i.prototype.walkSolution=function(){var i,o,n=t(this.solutionPath[this.solutionPath.length-1],2),s=n[0],e=n[1];i=this.data[this.cToI(s,e)];try{if(o=this.data[i.fromIndex],this.solutionPath.push([o.x,o.y]),!o.fromIndex)return this.isFinished=!0,this.pathFound(),!1}catch(h){throw h}return!0},i.prototype.findLowestNeighbor=function(t,i){var o,n;return o=this.data[this.cToI(t,i)],(n=this.data[this.cToI(t+1,i)])&&n.visited&&n.index<o.index&&(o=n),(n=this.data[this.cToI(t-1,i)])&&n.visited&&n.index<o.index&&(o=n),(n=this.data[this.cToI(t,i+1)])&&n.visited&&n.index<o.index&&(o=n),(n=this.data[this.cToI(t,i-1)])&&n.visited&&n.index<o.index&&(o=n),o},i.prototype.reset=function(){this.open=[],this.data=this.parseGridData(),this.isFinished=!1},i.prototype.cToI=function(t,i){return i*this.width+t},i.prototype.iToC=function(t){return[t%this.width,Math.floor(t/this.width)]},i}(),module.exports=s;
},{}],"gezO":[function(require,module,exports) {
module.exports="/demo/wAs/wolf.fa02d38f.png";
},{}],"Lphs":[function(require,module,exports) {
module.exports="/demo/wAs/sheep.555c8c42.png";
},{}],"L7ge":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=r(require("./img/wolf.png")),t=r(require("./img/sheep.png"));function r(e){return e&&e.__esModule?e:{default:e}}var o=document.getElementById("message"),s=o.querySelector("img"),u=o.querySelector("div");function i(r,i){s.src="wolf"===r?e.default:t.default,u.textContent=i,o.classList.add("show"),setTimeout(function(){return o.classList.remove("show")},2e3)}var l=i;exports.default=l;
},{"./img/wolf.png":"gezO","./img/sheep.png":"Lphs"}],"9QO6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=i(require("./search")),t=i(require("./message"));function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),e}function a(e,t){return e.x===t.x&&e.y===t.y}function w(e,t){return e+Math.floor((t-e)*Math.random())}var l=document.getElementById("wolf-img"),h=function(){function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.CELL_W;n(this,i),this.x=e,this.y=t,this.speed=i.wolves.length?w(2,4):2,this.size=s,this.isCallHelped=!1,this.stuck=0,this._timeStamp=Date.now()}return o(i,[{key:"draw",value:function(){var e=window.context;e.save(),e.drawImage(l,this.x,this.y,this.size,this.size),e.restore()}},{key:"move",value:function(){var n=Date.now();if(!(n-this._timeStamp<1e3/this.speed)){if(this._timeStamp=n,a(this,window.sheep))return(0,t.default)("wolf","哈哈哈，你被抓住了"),void(window.gameOver=!0);if(!this.path){var s=window.sheep,o=new e.default(window.gridData,[s.x/window.CELL_W,s.y/window.CELL_W]);o.beginFill(this),o.path&&(this.path=o.path)}if(this.path){this.size=window.CELL_W,this.stuck=0;var w=this.path.shift();w?(this.x=w[0]*window.CELL_W,this.y=w[1]*window.CELL_W):this.path=null}else{if(this.size=this.size===window.CELL_W?1.2*window.CELL_W:window.CELL_W,1===this.stuck){(0,t.default)("wolf",["你等着，我叫人去","我大哥来了你就死定了","我们老大马上就到","额，是个狠人","大大大大，大哥别杀我~"][i.wolves.length-1])}this.stuck++,this.stuck>6&&!this.isCallHelped&&(i.callHelp(),this.isCallHelped=!0)}}}}],[{key:"callHelp",value:function(){if(i.wolves.length>4)(0,t.default)("sheep","我们赢了！");else{var n,s=new e.default(window.gridData,[0,0]),o=window.sheep,a=o.x,w=o.y;s.findSteps([a/window.CELL_W,w/window.CELL_W],8);var l=s.data[s.open.pop()];l||(s.findSteps([a/window.CELL_W,w/window.CELL_W],2),l=s.data[s.open.pop()]),n=new i(l.x*window.CELL_W,l.y*window.CELL_W),i.wolves.push(n)}}}]),i}();h.wolves=[];var r=h;exports.default=r;
},{"./search":"zfSF","./message":"L7ge"}],"epB2":[function(require,module,exports) {
"use strict";var t=e(require("./wolf"));function e(t){return t&&t.__esModule?t:{default:t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}var o,a=document.getElementById("game"),u=a.getContext("2d"),f=document.getElementById("bg"),c=f.getContext("2d"),h=25,l=[],s=t.default.wolves;window.context=u;var d={x:0,y:0,draw:function(){u.drawImage(S,this.x,this.y,o,o)},init:function(){this.x=this.y=a.width-o}};window.sheep=d;var y=window.gameOver=!1,w=new t.default(0,0);function g(t,e,n){c.save(),c.strokeStyle=t,c.lineWidth=.5,c.clearRect(0,0,c.canvas.width,c.canvas.height);for(var r=e+.5;r<c.canvas.width;r+=e)c.beginPath(),c.moveTo(r,0),c.lineTo(r,c.canvas.height),c.stroke();for(r=n+.5;r<c.canvas.height;r+=n)c.beginPath(),c.moveTo(0,r),c.lineTo(c.canvas.width,r),c.stroke();c.restore()}s.push(w),window.gridData=Array(h).fill().map(function(){return Array(h).fill(0)});var v=function(){function t(e,r){n(this,t),this.x=e,this.y=r}return i(t,[{key:"draw",value:function(){u.save(),u.fillRect(this.x+1,this.y+1,o-1,o-1),u.restore()}}]),t}();function x(){for(var t=4*o;t<a.width-4*o;t+=o)for(var e=4*o;e<a.width-4*o;e+=o)t>10*o&&t<14*o&&e>10*o&&e<14*o||(l.push(new v(t,e)),window.gridData[t/o][e/o]=1)}function p(){u.fillStyle="rgba(255,165,0,0.5)",l.forEach(function(t){t.draw()})}function m(t){var e=[],n=l.length;switch(t){case"up":for(var r=0;r<n;r++)l[r].x==d.x&&l[r].y<=d.y&&e.push(l[r]);break;case"down":for(r=0;r<n;r++)l[r].x==d.x&&l[r].y>=d.y&&e.push(l[r]);break;case"left":for(r=0;r<n;r++)l[r].y==d.y&&l[r].x<=d.x&&e.push(l[r]);break;case"right":for(r=0;r<n;r++)l[r].y==d.y&&l[r].x>=d.x&&e.push(l[r])}return e}function b(t,e){var n,r=[];e=e||m(t);switch(t){case"up":n=d.y,e.sort(function(t,e){return t.y-e.y});for(var i=e.length-1;i>=0;i--)n-e[i].y==o&&(r.push(e[i]),n=e[i].y);break;case"down":n=d.y,e.sort(function(t,e){return t.y-e.y});for(i=0;i<e.length;i++)e[i].y-n==o&&(r.push(e[i]),n=e[i].y);break;case"left":n=d.x,e.sort(function(t,e){return t.x-e.x});for(var a=e.length-1;a>=0;a--)n-e[a].x==o&&(r.push(e[a]),n=e[a].x);break;case"right":n=d.x,e.sort(function(t,e){return t.x-e.x});for(var u=0;u<e.length;u++)e[u].x-n==o&&(r.push(e[u]),n=e[u].x)}return r}function k(e){var n,r,i=document.getElementById("fail");if(HTMLAudioElement.prototype.stop=function(){this.pause(),this.currentTime=0},"string"==typeof e)n=e;else{var u=e.keyCode?e.keyCode:e.which;e.preventDefault(),n=function(t){if(38===t||87===t)return"up";if(39===t||68===t)return"right";if(40===t||83===t)return"down";if(37===t||65===t)return"left"}(u)}function f(e){return t.default.wolves.some(function(t){return function(t,e){var n=r.length;if(0===n)return!1;var i=r[n-1];return"up"===e?i.x===t.x&&i.y-o===t.y:"down"===e?i.x===t.x&&i.y+o===t.y:"left"===e?i.y===t.y&&i.x-o===t.x:"right"===e?i.y===t.y&&i.x+o===t.x:void 0}(t,e)})}if(r=b(n),"up"===n){if(0===d.y)return;(r=b("up")).every(function(t){return t.y>0})&&!f("up")?(r.forEach(function(t){return t.y-=o}),d.y=d.y-o):(i.stop(),i.play())}if("right"===n){if(d.x===a.width-o)return;r.every(function(t){return t.x<a.width-o})&&!f("right")?(r.forEach(function(t){return t.x+=o}),d.x=d.x+o):(i.stop(),i.play())}if("down"===n){if(d.y===a.width-o)return;r.every(function(t){return t.y<a.height-o})&&!f("down")?(r.forEach(function(t){t.y+=o}),d.y=d.y+o):(i.stop(),i.play())}if("left"===n){if(0===d.x)return;r.every(function(t){return t.x>0})&&!f("left")?(r.forEach(function(t){t.x-=o}),d.x=d.x-o):(i.stop(),i.play())}window.gridData=Array(h).fill().map(function(){return Array(h).fill(0)}),l.forEach(function(t){return window.gridData[t.y/o][t.x/o]=1}),s.forEach(function(t){return t.path=null})}function E(){u.clearRect(0,0,a.width,a.height),p(),d.draw(),s.forEach(function(t){t.move(),t.draw()}),!window.gameOver&&requestAnimationFrame(E)}function P(){var t=(window.devicePixelRatio||1)/(u.webkitBackingStorePixelRatio||u.mozBackingStorePixelRatio||u.msBackingStorePixelRatio||u.oBackingStorePixelRatio||u.backingStorePixelRatio||1),e=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);[a,f].map(function(n){var r=n.width,i=n.height;n.width=r*t,n.height=i*t,e?(n.style.width="100vw",n.style.height="100vw"):(n.style.width=r+"px",n.style.height=i+"px"),o=n.width/h,window.CELL_W=o}),x(),d.init(),g("rgba(100,100,100,0.3)",Math.floor(a.width/h),Math.floor(a.height/h)),document.addEventListener("keydown",k),document.querySelector(".keyboard").addEventListener("touchstart",function(t){t.stopPropagation(),t.preventDefault(),k(t.target.id)}),E()}var B=document.getElementById("wolf-img"),S=document.getElementById("sheep-img"),R=[S,B].map(function(t){return new Promise(function(e,n){t.onload=function(){console.log("load",t),e()}})});P();
},{"./wolf":"9QO6"}]},{},["epB2"], null)
//# sourceMappingURL=/demo/wAs/main.b38e101b.js.map