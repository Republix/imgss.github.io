{"version":3,"sources":["search.js","message.js","wolf.js","main.js"],"names":["Pathfinder","gridData","targetPosition","foundCallback","width","length","height","prototype","parseGridData","cell","data","index","node","row","x","y","_i","_j","_len","_len1","_ref","open","visited","beginFill","wolf","window","CELL_W","startPosition","reset","closeNode","addNeighbors","isFinished","nextStep","findSteps","step","iToC","shift","cToI","addOpen","nodeIndex","tX","tY","push","fromIndex","targetFound","err","console","log","_results","solutionPath","walkSolution","pathFound","path","reverse","slice","lastNode","nextNode","findLowestNeighbor","candidateNode","Math","floor","module","exports","show","msg","document","getElementById","avatar","querySelector","content","who","word","src","wImg","sImg","textContent","classList","add","setTimeout","remove","Wolf","sameLocation","a","b","rand","min","max","random","wolfImg","size","speed","wolves","isCallHelped","stuck","_timeStamp","Date","now","context","save","drawImage","restore","sheep","gameOver","pathFinder","point","callHelp","pf","targetPoint","pop","can","getContext","can2","ctx","GRID_NUM","walls","draw","sheepImg","init","drawGrid","color","stepx","stepy","strokeStyle","lineWidth","clearRect","canvas","i","beginPath","moveTo","lineTo","stroke","Array","fill","map","Block","fillRect","wallsInit","j","wallsDraw","fillStyle","forEach","wall","wallLine","direction","len","wallAffect","dir","wl","wallToMove","pointer","sort","k","m","sheepMove","e","moveBlocks","keyID","keyCode","which","preventDefault","getDirection","isWolfInTheWay","lastBlock","every","ele","w","loop","move","requestAnimationFrame","main","devicePixelRatio","ratio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","isMobile","navigator","userAgent","match","oldWidth","oldHeight","style","addEventListener","stopPropagation","target","id","promiseArr","el","Promise","resolve","reject","onload"],"mappings":";AAoMA,SAAA,EAAA,EAAA,GAAA,OAAA,EAAA,IAAA,EAAA,EAAA,IAAA,IAAA,SAAA,IAAA,MAAA,IAAA,UAAA,wDAAA,SAAA,EAAA,EAAA,GAAA,IAAA,EAAA,GAAA,GAAA,EAAA,GAAA,EAAA,OAAA,EAAA,IAAA,IAAA,IAAA,EAAA,EAAA,EAAA,OAAA,cAAA,GAAA,EAAA,EAAA,QAAA,QAAA,EAAA,KAAA,EAAA,QAAA,GAAA,EAAA,SAAA,GAAA,GAAA,IAAA,MAAA,GAAA,GAAA,EAAA,EAAA,EAAA,QAAA,IAAA,GAAA,MAAA,EAAA,QAAA,EAAA,SAAA,QAAA,GAAA,EAAA,MAAA,GAAA,OAAA,EAAA,SAAA,EAAA,GAAA,GAAA,MAAA,QAAA,GAAA,OAAA,EAnMA,IAAIA,EACJA,EAAc,WACHA,SAAAA,EAAWC,EAAUC,EAAgBC,GACvCF,KAAAA,SAAWA,EACXC,KAAAA,eAAiBA,EAEjBC,KAAAA,cAAgBA,EAChBC,KAAAA,MAAQ,KAAKH,SAAS,GAAGI,OACzBC,KAAAA,OAAS,KAAKL,SAASI,OAwLvBL,OArLPA,EAAWO,UAAUC,cAAgB,WAC/BC,IAAMC,EAAMC,EAAOC,EAAMC,EAAKC,EAAGC,EAAGC,EAAIC,EAAIC,EAAMC,EAAOC,EAGxDL,IAFLL,EAAO,GAEFK,EAAIC,EAAK,EAAGE,GADjBE,EAAO,KAAKnB,UACiBI,OAAQW,EAAKE,EAAMH,IAAMC,EAE/CF,IAAAA,EAAIG,EAAK,EAAGE,GADjBN,EAAMO,EAAKL,IACkBV,OAAQY,EAAKE,EAAOL,IAAMG,EAGrDL,EAAO,CACLS,MAHKR,EAAIC,GAITQ,SAAS,EACTX,MAJFA,EAAQI,EAAI,KAAKX,MAAQU,EAKvBA,EAAGA,EACHC,EAAGA,GAELL,EAAKC,GAASC,EAGXF,OAAAA,GAGTV,EAAWO,UAAUgB,UAAY,SAASC,GACnCV,IAAAA,EAAQU,EAARV,EAAGC,EAAKS,EAALT,EAOD,IANPD,GAAQW,OAAOC,OACfX,GAAQU,OAAOC,OACVC,KAAAA,cAAgB,CAACb,EAAGC,GACpBa,KAAAA,QACAC,KAAAA,UAAUf,EAAGC,GACbe,KAAAA,aAAahB,EAAGC,IACb,KAAKgB,YACNC,KAAAA,YAOThC,EAAWO,UAAU0B,UAAY,SAASN,EAAeO,GAC1CP,IAAAA,EAAAA,EAAAA,EADgD,GACxDb,EADwD,EAAA,GACrDC,EADqD,EAAA,GAMtDmB,IAJFP,KAAAA,cAAgBA,EAChBC,KAAAA,QACAC,KAAAA,UAAUf,EAAGC,GACbe,KAAAA,aAAahB,EAAGC,GACdmB,KACAF,KAAAA,YAIThC,EAAWO,UAAUyB,SAAW,WAC1BlB,IAAAA,EAAGC,EAAGK,EACN,GAAqB,IAArB,KAAKC,KAAKhB,OAMP,OAF8BS,GAArCM,EAAO,KAAKe,KAAK,KAAKd,KAAKe,UAAmB,GAAIrB,EAAIK,EAAK,GACtDS,KAAAA,UAAUf,EAAGC,GACX,KAAKe,aAAahB,EAAGC,GALrBgB,KAAAA,YAAa,GAQtB/B,EAAWO,UAAUuB,aAAe,SAAShB,EAAGC,GAC1CJ,IAAAA,EACJA,EAAQ,KAAKD,KAAK,KAAK2B,KAAKvB,EAAGC,IAAIJ,MAC9B2B,KAAAA,QAAQxB,EAAI,EAAGC,EAAGJ,GACvBG,EAAI,GAAK,GAAK,KAAKwB,QAAQxB,EAAI,EAAGC,EAAGJ,GAChC2B,KAAAA,QAAQxB,EAAGC,EAAI,EAAGJ,GACvBI,EAAI,GAAK,GAAK,KAAKuB,QAAQxB,EAAGC,EAAI,EAAGJ,IAGvCX,EAAWO,UAAU+B,QAAU,SAASxB,EAAGC,EAAGwB,GACxC5B,IAAAA,EAAOC,EAAM4B,EAAIC,EAAIrB,EACtBN,KAAAA,EAAI,GAAKA,EAAI,KAAKV,MAAQ,GAAKW,EAAI,GAAKA,EAAI,KAAKT,OAAS,GAYzDQ,OAXJH,EAAQ,KAAK0B,KAAKvB,EAAGC,IAErBH,EAAO,KAAKF,KAAKC,IAERU,OACFA,KAAAA,KAAKqB,KAAK/B,GACfC,EAAK+B,UAAYJ,EACjB3B,EAAKS,MAAO,EACZT,EAAKU,SAAU,GAEWkB,GAA5BpB,EAAO,KAAKlB,gBAA0B,GAAIuC,EAAKrB,EAAK,GAChDN,IAAM0B,GAAMzB,IAAM0B,EACb,KAAKG,mBADV9B,GAKNd,EAAWO,UAAUsB,UAAY,SAASf,EAAGC,GACvCH,IAAAA,EACJA,EAAO,KAAKF,KAAK,KAAK2B,KAAKvB,EAAGC,IAC1B,IACFH,EAAKS,MAAO,EACZ,MAAOwB,GACPC,QAAQC,IAAI,MACZD,QAAQC,IAAIjC,EAAGC,KAKnBf,EAAWO,UAAUqC,YAAc,WAC7BI,IAAAA,EAMG,IALFjB,KAAAA,YAAa,EACbkB,KAAAA,aAAe,GACfA,KAAAA,aAAaP,KAAK,KAAKxC,gBAC5B8C,EAAW,GAEJ,KAAKE,gBACVF,EAASN,MAAK,GAETM,OAAAA,GAGThD,EAAWO,UAAU4C,UAAY,WAC3BC,IAAAA,EACJA,EAAO,KAAKH,aAAaI,UACpBD,KAAAA,KAAOA,EAAKE,MAAM,GAClBnD,KAAAA,eAAiB,KAAKA,cAAciD,IAG3CpD,EAAWO,UAAU2C,aAAe,WAC9BK,IAAAA,EAAUC,EAD+B,EAAA,EAEtC,KAAKP,aAAa,KAAKA,aAAa5C,OAAS,GAFP,GAGxCS,EAHwC,EAAA,GAGrCC,EAHqC,EAAA,GAI7CwC,EAAW,KAAK7C,KAAK,KAAK2B,KAAKvB,EAAGC,IAC9B,IAGE,GAFJyC,EAAW,KAAK9C,KAAK6C,EAASZ,WACzBM,KAAAA,aAAaP,KAAK,CAACc,EAAS1C,EAAG0C,EAASzC,KACxCyC,EAASb,UAGL,OAFFZ,KAAAA,YAAa,EACboB,KAAAA,aACE,EAET,MAAMN,GACAA,MAAAA,EAID,OAAA,GAGT7C,EAAWO,UAAUkD,mBAAqB,SAAS3C,EAAGC,GAChD2C,IAAAA,EAAe9C,EAkBZ8C,OAjBPA,EAAgB,KAAKhD,KAAK,KAAK2B,KAAKvB,EAAGC,KACvCH,EAAO,KAAKF,KAAK,KAAK2B,KAAKvB,EAAI,EAAGC,MACtBH,EAAKU,SAAWV,EAAKD,MAAQ+C,EAAc/C,QACrD+C,EAAgB9C,IAElBA,EAAO,KAAKF,KAAK,KAAK2B,KAAKvB,EAAI,EAAGC,MACtBH,EAAKU,SAAWV,EAAKD,MAAQ+C,EAAc/C,QACrD+C,EAAgB9C,IAElBA,EAAO,KAAKF,KAAK,KAAK2B,KAAKvB,EAAGC,EAAI,MACtBH,EAAKU,SAAWV,EAAKD,MAAQ+C,EAAc/C,QACrD+C,EAAgB9C,IAElBA,EAAO,KAAKF,KAAK,KAAK2B,KAAKvB,EAAGC,EAAI,MACtBH,EAAKU,SAAWV,EAAKD,MAAQ+C,EAAc/C,QACrD+C,EAAgB9C,GAEX8C,GAGT1D,EAAWO,UAAUqB,MAAQ,WACtBP,KAAAA,KAAO,GACPX,KAAAA,KAAO,KAAKF,gBACZuB,KAAAA,YAAa,GAIpB/B,EAAWO,UAAU8B,KAAO,SAASvB,EAAGC,GAC/BA,OAAAA,EAAI,KAAKX,MAAQU,GAG1Bd,EAAWO,UAAU4B,KAAO,SAASxB,GAI5B,MAAA,CAFHA,EAAQ,KAAKP,MACbuD,KAAKC,MAAMjD,EAAQ,KAAKP,SAIvBJ,EA/LK,GAkMd6D,OAAOC,QAAW9D;;;;;;ACxLH+D,aAAAA,OAAAA,eAAAA,QAAAA,aAAAA,CAAAA,OAAAA,IAAAA,QAAAA,aAAAA,EAZf,IAAA,EAAA,EAAA,QAAA,mBACA,EAAA,EAAA,QAAA,oBAWeA,SAAAA,EAAAA,GAAAA,OAAAA,GAAAA,EAAAA,WAAAA,EAAAA,CAAAA,QAAAA,GATf,IAAIC,EAAMC,SAASC,eAAe,WAC9BC,EAASH,EAAII,cAAc,OAC3BC,EAAUL,EAAII,cAAc,OAChC,SAASL,EAAKO,EAAKC,GACjBJ,EAAOK,IAAc,SAARF,EAAiBG,EAAjB,QAAwBC,EAArC,QACAL,EAAQM,YAAcJ,EACtBP,EAAIY,UAAUC,IAAI,QAClBC,WAAW,WAAMd,OAAAA,EAAIY,UAAUG,OAAO,SAAS,KAElChB,IAAAA,EAAAA,EAAAA,QAAAA,QAAAA;;AC8FAiB,aAAAA,OAAAA,eAAAA,QAAAA,aAAAA,CAAAA,OAAAA,IAAAA,QAAAA,aAAAA,EA1Gf,IAAA,EAAA,EAAA,QAAA,aACA,EAAA,EAAA,QAAA,cAyGeA,SAAAA,EAAAA,GAAAA,OAAAA,GAAAA,EAAAA,WAAAA,EAAAA,CAAAA,QAAAA,GAAAA,SAAAA,EAAAA,EAAAA,GAAAA,KAAAA,aAAAA,GAAAA,MAAAA,IAAAA,UAAAA,qCAAAA,SAAAA,EAAAA,EAAAA,GAAAA,IAAAA,IAAAA,EAAAA,EAAAA,EAAAA,EAAAA,OAAAA,IAAAA,CAAAA,IAAAA,EAAAA,EAAAA,GAAAA,EAAAA,WAAAA,EAAAA,aAAAA,EAAAA,EAAAA,cAAAA,EAAAA,UAAAA,IAAAA,EAAAA,UAAAA,GAAAA,OAAAA,eAAAA,EAAAA,EAAAA,IAAAA,IAAAA,SAAAA,EAAAA,EAAAA,EAAAA,GAAAA,OAAAA,GAAAA,EAAAA,EAAAA,UAAAA,GAAAA,GAAAA,EAAAA,EAAAA,GAAAA,EAxGf,SAASC,EAAaC,EAAGC,GAChBD,OAAAA,EAAEpE,IAAMqE,EAAErE,GAAKoE,EAAEnE,IAAMoE,EAAEpE,EAElC,SAASqE,EAAKC,EAAKC,GACVD,OAAAA,EAAM1B,KAAKC,OAAO0B,EAAID,GAAO1B,KAAK4B,UAE3C,IAAIC,EAAUvB,SAASC,eAAe,YAChCc,EAiGSA,WAhGmC,SAAA,IAApClE,IAAAA,EAAI,UAAA,OAAA,QAAA,IAAA,UAAA,GAAA,UAAA,GAAA,EAAGC,EAAI,UAAA,OAAA,QAAA,IAAA,UAAA,GAAA,UAAA,GAAA,EAAG0E,EAAOhE,UAAAA,OAAAA,QAAAA,IAAAA,UAAAA,GAAAA,UAAAA,GAAAA,OAAOC,OAAQ,EAAA,KAAA,GACzCZ,KAAAA,EAAIA,EACJC,KAAAA,EAAIA,EACJ2E,KAAAA,MAAQV,EAAKW,OAAOtF,OAAS+E,EAAK,EAAG,GAAK,EAC1CK,KAAAA,KAAOA,EACPG,KAAAA,cAAe,EACfC,KAAAA,MAAQ,EAERC,KAAAA,WAAaC,KAAKC,MAwFZhB,OAAAA,EAAAA,EAAAA,CAAAA,CAAAA,IAAAA,OArFN,MAAA,WACDiB,IAAAA,EAAUxE,OAAOwE,QACrBA,EAAQC,OACRD,EAAQE,UAAUX,EAAS,KAAK1E,EAAG,KAAKC,EAAG,KAAK0E,KAAM,KAAKA,MAY3DQ,EAAQG,YAsEGpB,CAAAA,IAAAA,OAnEN,MAAA,WACCgB,IAAAA,EAAMD,KAAKC,MACXA,KAAAA,EAAM,KAAKF,WAAa,IAAO,KAAKJ,OAApCM,CAEAf,GADCa,KAAAA,WAAaE,EACdf,EAAa,KAAMxD,OAAO4E,OAG1B,OAFI,EAAA,EAAA,SAAA,OAAQ,kBACZ5E,OAAO6E,UAAW,GAGlB,IAAC,KAAKlD,KAAM,CACRiD,IAAAA,EAAQ5E,OAAO4E,MACfE,EAAa,IAAIvG,EAAJ,QAAeyB,OAAOxB,SAAU,CAAEoG,EAAMvF,EAAGW,OAAOC,OAAS2E,EAAMtF,EAAGU,OAAOC,SAC5F6E,EAAWhF,UAAU,MACjBgF,EAAWnD,OACNA,KAAAA,KAAOmD,EAAWnD,MAG3B,GAAA,KAAKA,KAAM,CACNqC,KAAAA,KAAOhE,OAAOC,OACdmE,KAAAA,MAAQ,EACTW,IAAAA,EAAQ,KAAKpD,KAAKhB,QAClBoE,GACK1F,KAAAA,EAAI0F,EAAM,GAAK/E,OAAOC,OACtBX,KAAAA,EAAIyF,EAAM,GAAK/E,OAAOC,QAEtB0B,KAAAA,KAAO,SAEb,CAEC,GADCqC,KAAAA,KAAO,KAAKA,OAAShE,OAAOC,OAAyB,IAAhBD,OAAOC,OAAeD,OAAOC,OACpD,IAAf,KAAKmE,MAAa,EAQhB,EAAA,EAAA,SAAA,OAPO,CACT,WACA,aACA,WACA,SACA,eAEeb,EAAKW,OAAOtF,OAAO,IAEjCwF,KAAAA,QACD,KAAKA,MAAQ,IAAM,KAAKD,eAC1BZ,EAAKyB,WACAb,KAAAA,cAAe,QAyBjBZ,CAAAA,CAAAA,IAAAA,WApBK,MAAA,WACZA,GAAAA,EAAKW,OAAOtF,OAAS,GACnB,EAAA,EAAA,SAAA,QAAS,aADX2E,CAKA0B,IAEAlF,EAFAkF,EAAK,IAAI1G,EAAJ,QAAeyB,OAAOxB,SAAU,CAAC,EAAE,IAC/BwB,EAAAA,OAAO4E,MAAfvF,EAAAA,EAAAA,EAAGC,EAAAA,EAAAA,EAER2F,EAAGzE,UAAU,CAACnB,EAAIW,OAAOC,OAAQX,EAAIU,OAAOC,QAAS,GACjDiF,IAAAA,EAAcD,EAAGhG,KAAKgG,EAAGrF,KAAKuF,OAC7BD,IACHD,EAAGzE,UAAU,CAACnB,EAAIW,OAAOC,OAAQX,EAAIU,OAAOC,QAAS,GACrDiF,EAAcD,EAAGhG,KAAKgG,EAAGrF,KAAKuF,QAEhCpF,EAAO,IAAIwD,EAAK2B,EAAY7F,EAAIW,OAAOC,OAAQiF,EAAY5F,EAAIU,OAAOC,QACtEsD,EAAKW,OAAOjD,KAAKlB,QAINwD,EAAAA,GADfA,EAAKW,OAAS,GACCX,IAAAA,EAAAA,EAAAA,QAAAA,QAAAA;;AC4QX,aAnXJ,IAAA,EAAA,EAAA,QAAA,WAmXI,SAAA,EAAA,GAAA,OAAA,GAAA,EAAA,WAAA,EAAA,CAAA,QAAA,GAAA,SAAA,EAAA,EAAA,GAAA,KAAA,aAAA,GAAA,MAAA,IAAA,UAAA,qCAAA,SAAA,EAAA,EAAA,GAAA,IAAA,IAAA,EAAA,EAAA,EAAA,EAAA,OAAA,IAAA,CAAA,IAAA,EAAA,EAAA,GAAA,EAAA,WAAA,EAAA,aAAA,EAAA,EAAA,cAAA,EAAA,UAAA,IAAA,EAAA,UAAA,GAAA,OAAA,eAAA,EAAA,EAAA,IAAA,IAAA,SAAA,EAAA,EAAA,EAAA,GAAA,OAAA,GAAA,EAAA,EAAA,UAAA,GAAA,GAAA,EAAA,EAAA,GAAA,EAlXJ,IAMItD,EANAmF,EAAM5C,SAASC,eAAe,QAChC+B,EAAUY,EAAIC,WAAW,MACzBC,EAAO9C,SAASC,eAAe,MAC/B8C,EAAMD,EAAKD,WAAW,MAClBG,EAAW,GAIbC,EAAQ,GACVvB,EAASX,EAAKW,QAAAA,OAChBlE,OAAOwE,QAAUA,EACjB,IAAII,EAAQ,CACVvF,EAAG,EACHC,EAAG,EACHoG,KAAO,WACLlB,EAAQE,UAAUiB,EAAU,KAAKtG,EAAG,KAAKC,EAAGW,EAAQA,IAEtD2F,KAAO,WACAvG,KAAAA,EAAI,KAAKC,EAAI8F,EAAIzG,MAAQsB,IAIlCD,OAAO4E,MAAQA,EAEf,IAAIC,EAAY7E,OAAO6E,UAAW,EAC9B9E,EAAO,IAAIwD,EAAJ,QAAS,EAAG,GAMvB,SAASsC,EAASC,EAAOC,EAAOC,GAC9BT,EAAId,OACJc,EAAIU,YAAcH,EAClBP,EAAIW,UAAY,GAChBX,EAAIY,UAAU,EAAG,EAAGZ,EAAIa,OAAOzH,MAAO4G,EAAIa,OAAOvH,QAE5C,IAAA,IAAIwH,EAAIN,EAAQ,GAAKM,EAAId,EAAIa,OAAOzH,MAAO0H,GAAKN,EACnDR,EAAIe,YACJf,EAAIgB,OAAOF,EAAG,GACdd,EAAIiB,OAAOH,EAAGd,EAAIa,OAAOvH,QACzB0G,EAAIkB,SAGD,IAAIJ,EAAIL,EAAQ,GAAKK,EAAId,EAAIa,OAAOvH,OAAQwH,GAAKL,EACpDT,EAAIe,YACJf,EAAIgB,OAAO,EAAGF,GACdd,EAAIiB,OAAOjB,EAAIa,OAAOzH,MAAO0H,GAC7Bd,EAAIkB,SAGNlB,EAAIZ,UAzBNT,EAAOjD,KAAKlB,GACZC,OAAOxB,SAAWkI,MAAMlB,GACrBmB,OACAC,IAAI,WAAMF,OAAAA,MAAMlB,GAAUmB,KAAK,KAyB5BE,IAAAA,EA4TF,WA3TUxH,SAAAA,EAAAA,EAAGC,GAAG,EAAA,KAAA,GAEXD,KAAAA,EAAIA,EACJC,KAAAA,EAAIA,EAwTT,OAAA,EAAA,EAAA,CAAA,CAAA,IAAA,OAtTK,MAAA,WACLkF,EAAQC,OACRD,EAAQsC,SAAS,KAAKzH,EAAI,EAAG,KAAKC,EAAI,EAAGW,EAAS,EAAGA,EAAS,GAE9DuE,EAAQG,cAkTR,EAAA,GA9SJ,SAASoC,IACF,IAAA,IAAIV,EAAa,EAATpG,EAAYoG,EAAIjB,EAAIzG,MAAiB,EAATsB,EAAYoG,GAAKpG,EACnD,IAAA,IAAI+G,EAAa,EAAT/G,EAAY+G,EAAI5B,EAAIzG,MAAiB,EAATsB,EAAY+G,GAAK/G,EAClDoG,EAAI,KAAOA,EAAI,KAAQW,EAAI,KAAOA,EAAI,MAE1CvB,EAAMxE,KAAK,IAAI4F,EAAMR,EAAGW,IACxBhH,OAAOxB,SAAS6H,EAAIpG,GAAQ+G,EAAI/G,GAAU,GAMlD,SAASgH,IACPzC,EAAQ0C,UAAY,sBACpBzB,EAAM0B,QAAQ,SAASC,GACrBA,EAAK1B,SAKT,SAAS2B,EAASC,GAEZD,IAAAA,EAAW,GACXE,EAAM9B,EAAM7G,OACR0I,OAAAA,GACD,IAAA,KACE,IAAA,IAAIjB,EAAI,EAAGA,EAAIkB,EAAKlB,IACnBZ,EAAMY,GAAGhH,GAAKuF,EAAMvF,GAAKoG,EAAMY,GAAG/G,GAAKsF,EAAMtF,GAC/C+H,EAASpG,KAAKwE,EAAMY,IAGxB,MACG,IAAA,OACE,IAAIA,EAAI,EAAGA,EAAIkB,EAAKlB,IACnBZ,EAAMY,GAAGhH,GAAKuF,EAAMvF,GAAKoG,EAAMY,GAAG/G,GAAKsF,EAAMtF,GAC/C+H,EAASpG,KAAKwE,EAAMY,IAGxB,MACG,IAAA,OACE,IAAIA,EAAI,EAAGA,EAAIkB,EAAKlB,IACnBZ,EAAMY,GAAG/G,GAAKsF,EAAMtF,GAAKmG,EAAMY,GAAGhH,GAAKuF,EAAMvF,GAC/CgI,EAASpG,KAAKwE,EAAMY,IAGxB,MACG,IAAA,QACE,IAAIA,EAAI,EAAGA,EAAIkB,EAAKlB,IACnBZ,EAAMY,GAAG/G,GAAKsF,EAAMtF,GAAKmG,EAAMY,GAAGhH,GAAKuF,EAAMvF,GAC/CgI,EAASpG,KAAKwE,EAAMY,IAKrBgB,OAAAA,EAIT,SAASG,EAAWC,EAAKC,GACnBC,IAEFC,EAFED,EAAa,GACfD,EAAKA,GAAML,EAASI,GAEdA,OAAAA,GACD,IAAA,KAEDG,EAAUhD,EAAMtF,EAChBoI,EAAGG,KAAK,SAACpE,EAAGC,GAAMD,OAAAA,EAAEnE,EAAIoE,EAAEpE,IACrB,IAAA,IAAI0H,EAAIU,EAAG9I,OAAS,EAAGoI,GAAK,EAAGA,IAC9BY,EAAUF,EAAGV,GAAG1H,GAAKW,IACvB0H,EAAW1G,KAAKyG,EAAGV,IACnBY,EAAUF,EAAGV,GAAG1H,GAItB,MACG,IAAA,OAEDsI,EAAUhD,EAAMtF,EAChBoI,EAAGG,KAAK,SAACpE,EAAGC,GAAMD,OAAAA,EAAEnE,EAAIoE,EAAEpE,IACrB,IAAI0H,EAAI,EAAGA,EAAIU,EAAG9I,OAAQoI,IACzBU,EAAGV,GAAG1H,EAAIsI,GAAW3H,IACvB0H,EAAW1G,KAAKyG,EAAGV,IACnBY,EAAUF,EAAGV,GAAG1H,GAItB,MACG,IAAA,OAEDsI,EAAUhD,EAAMvF,EAChBqI,EAAGG,KAAK,SAACpE,EAAGC,GAAMD,OAAAA,EAAEpE,EAAIqE,EAAErE,IACrB,IAAA,IAAIyI,EAAIJ,EAAG9I,OAAS,EAAGkJ,GAAK,EAAGA,IAC9BF,EAAUF,EAAGI,GAAGzI,GAAKY,IACvB0H,EAAW1G,KAAKyG,EAAGI,IACnBF,EAAUF,EAAGI,GAAGzI,GAItB,MACG,IAAA,QAEDuI,EAAUhD,EAAMvF,EAChBqI,EAAGG,KAAK,SAACpE,EAAGC,GAAMD,OAAAA,EAAEpE,EAAIqE,EAAErE,IACrB,IAAA,IAAI0I,EAAI,EAAGA,EAAIL,EAAG9I,OAAQmJ,IACzBL,EAAGK,GAAG1I,EAAIuI,GAAW3H,IACvB0H,EAAW1G,KAAKyG,EAAGK,IACnBH,EAAUF,EAAGK,GAAG1I,GAMnBsI,OAAAA,EAGT,SAASK,EAAUC,GACbX,IAAAA,EAAWY,EACX,GAAa,iBAAND,EACTX,EAAYW,MACP,CACDE,IAAAA,EAAQF,EAAEG,QAAUH,EAAEG,QAAUH,EAAEI,MACtCJ,EAAEK,iBACFhB,EAGOiB,SAAaJ,GAChBA,GAAU,KAAVA,GAA0B,KAAVA,EACX,MAAA,KAELA,GAAU,KAAVA,GAA0B,KAAVA,EACX,MAAA,QAELA,GAAU,KAAVA,GAA0B,KAAVA,EACX,MAAA,OAELA,GAAU,KAAVA,GAA0B,KAAVA,EACX,MAAA,OAdGI,CAAaJ,GAkBlBK,SAAAA,EAAelB,GAClBC,IAAAA,EAAMW,EAAWtJ,OACjB2I,GAAQ,IAARA,EAAW,OAAO,EAElBkB,IAAAA,EAAYP,EAAWX,EAAM,GAC7BD,MAAc,OAAdA,EACKmB,EAAUpJ,IAAMU,EAAKV,GAAKoJ,EAAUnJ,EAAIW,IAAWF,EAAKT,EAE/C,SAAdgI,EACKmB,EAAUpJ,IAAMU,EAAKV,GAAKoJ,EAAUnJ,EAAIW,IAAWF,EAAKT,EAE/C,SAAdgI,EACKmB,EAAUnJ,IAAMS,EAAKT,GAAKmJ,EAAUpJ,EAAIY,IAAWF,EAAKV,EAE/C,UAAdiI,EACKmB,EAAUnJ,IAAMS,EAAKT,GAAKmJ,EAAUpJ,EAAIY,IAAWF,EAAKV,OAD7DiI,EAKFA,GAnCJY,EAAaV,EAAWF,GAmCN,OAAdA,EAAoB,CAElB1C,GAAY,IAAZA,EAAMtF,EAAS,QACnB4I,EAAaV,EAAW,OACTkB,MAAM,SAAAT,GAAKA,OAAAA,EAAE3I,EAAI,MAAOkJ,EAAe,QACpDN,EAAWf,QAAQ,SAAAwB,GAAQA,OAAAA,EAAIrJ,GAAKW,IACpC2E,EAAMtF,EAAIsF,EAAMtF,EAAIW,GAGpBqH,GAAc,UAAdA,EAAuB,CAErB1C,GAAAA,EAAMvF,IAAM+F,EAAIzG,MAAQsB,EAAQ,OAElCiI,EAAWQ,MAAM,SAAAT,GAAKA,OAAAA,EAAE5I,EAAI+F,EAAIzG,MAAQsB,MACvCuI,EAAe,WAEhBN,EAAWf,QAAQ,SAAAwB,GAAQA,OAAAA,EAAItJ,GAAKY,IACpC2E,EAAMvF,EAAIuF,EAAMvF,EAAIY,GAGpBqH,GAAc,SAAdA,EAAsB,CAEpB1C,GAAAA,EAAMtF,IAAM8F,EAAIzG,MAAQsB,EAAQ,OAElCiI,EAAWQ,MAAM,SAAAT,GAAKA,OAAAA,EAAE3I,EAAI8F,EAAIvG,OAASoB,MACxCuI,EAAe,UAEhBN,EAAWf,QAAQ,SAASwB,GAC1BA,EAAIrJ,GAAKW,IAEX2E,EAAMtF,EAAIsF,EAAMtF,EAAIW,GAGpBqH,GAAc,SAAdA,EAAsB,CAGpB1C,GAAY,IAAZA,EAAMvF,EAAS,OACf6I,EAAWQ,MAAM,SAAAT,GAAKA,OAAAA,EAAE5I,EAAI,MAAOmJ,EAAe,UACpDN,EAAWf,QAAQ,SAASwB,GAC1BA,EAAItJ,GAAKY,IAEX2E,EAAMvF,EAAIuF,EAAMvF,EAAIY,GAGxBD,OAAOxB,SAAWkI,MAAMlB,GACrBmB,OACAC,IAAI,WAAMF,OAAAA,MAAMlB,GAAUmB,KAAK,KAClClB,EAAM0B,QAAQ,SAAAyB,GAAM5I,OAAAA,OAAOxB,SAASoK,EAAEtJ,EAAIW,GAAQ2I,EAAEvJ,EAAIY,GAAU,IAClEiE,EAAOiD,QAAQ,SAAApH,GAASA,OAAAA,EAAK4B,KAAO,OAGtC,SAASkH,IACPrE,EAAQ2B,UAAU,EAAG,EAAGf,EAAIzG,MAAOyG,EAAIvG,QACvCoI,IACArC,EAAMc,OACNxB,EAAOiD,QAAQ,SAAApH,GACbA,EAAK+I,OACL/I,EAAK2F,UAEN1F,OAAO6E,UAAYkE,sBAAsBF,GAG5C,SAASG,IACHC,IAQFC,GARqBlJ,OAAOiJ,kBAAoB,IAE9CzE,EAAQ2E,8BACR3E,EAAQ4E,2BACR5E,EAAQ6E,0BACR7E,EAAQ8E,yBACR9E,EAAQ+E,wBACR,GAEAC,EAAWC,UAAUC,UAAUC,MACjC,mJAEDvE,CAAAA,EAAKE,GAAMsB,IAAI,SAASR,GACnBwD,IAAAA,EAAWxD,EAAOzH,MAClBkL,EAAYzD,EAAOvH,OACvBuH,EAAOzH,MAAQiL,EAAWV,EAC1B9C,EAAOvH,OAASgL,EAAYX,EACxBM,GACFpD,EAAO0D,MAAMnL,MAAQ,QACrByH,EAAO0D,MAAMjL,OAAS,UAEtBuH,EAAO0D,MAAMnL,MAAQiL,EAAW,KAChCxD,EAAO0D,MAAMjL,OAASgL,EAAY,MAGpC5J,EAASmG,EAAOzH,MAAQ6G,EACxBxF,OAAOC,OAASA,IAuBlB8G,IACAnC,EAAMgB,OACNC,EACE,wBACA3D,KAAKC,MAAMiD,EAAIzG,MAAQ6G,GACvBtD,KAAKC,MAAMiD,EAAIvG,OAAS2G,IAE1BhD,SAASuH,iBAAiB,UAAW/B,GACrCxF,SACGG,cAAc,aACdoH,iBAAiB,aAAc,SAAS9B,GACvCA,EAAE+B,kBACF/B,EAAEK,iBACFN,EAAUC,EAAEgC,OAAOC,MAEvBrB,IAEF,IAAI9E,EAAUvB,SAASC,eAAe,YAClCkD,EAAWnD,SAASC,eAAe,aACnC0H,EAAa,CAACxE,EAAU5B,GAAS6C,IACnC,SAAAwD,GACE,OAAA,IAAIC,QAAQ,SAASC,EAASC,GAC5BH,EAAGI,OAAS,WACVnJ,QAAQC,IAAI,OAAQ8I,GACpBE,SAORtB","file":"main.397532e5.js","sourceRoot":"../../../../game/wAs","sourcesContent":["// 参考: https://codepen.io/clindsey/pen/yNvYxE\nvar Pathfinder;\nPathfinder = (function() {\n  function Pathfinder(gridData, targetPosition, foundCallback) {\n    this.gridData = gridData;\n    this.targetPosition = targetPosition;\n\n    this.foundCallback = foundCallback;\n    this.width = this.gridData[0].length;\n    this.height = this.gridData.length;\n  }\n\n  Pathfinder.prototype.parseGridData = function() {\n    var cell, data, index, node, row, x, y, _i, _j, _len, _len1, _ref;\n    data = [];\n    _ref = this.gridData;\n    for (y = _i = 0, _len = _ref.length; _i < _len; y = ++_i) {\n      row = _ref[y];\n      for (x = _j = 0, _len1 = row.length; _j < _len1; x = ++_j) {\n        cell = row[x];\n        index = y * this.width + x;\n        node = {\n          open: !cell, // 是不是墙\n          visited: false,\n          index: index,\n          x: x,\n          y: y\n        };\n        data[index] = node;\n      }\n    }\n    return data;\n  };\n\n  Pathfinder.prototype.beginFill = function(wolf) {\n    let {x, y} = wolf;\n    x = x / window.CELL_W;\n    y = y / window.CELL_W;\n    this.startPosition = [x, y];\n    this.reset();\n    this.closeNode(x, y);\n    this.addNeighbors(x, y);\n    while (!this.isFinished) {\n      this.nextStep();\n    }\n  };\n  /**\n   * @description 找出距startPosition节点step范围内的一个可用节点\n   * @return [x,y]\n   */\n  Pathfinder.prototype.findSteps = function(startPosition, step) {\n    let [x, y] = startPosition;\n    this.startPosition = startPosition;\n    this.reset();\n    this.closeNode(x, y);\n    this.addNeighbors(x, y);\n    while (step--) {\n      this.nextStep();\n    }\n  };\n\n  Pathfinder.prototype.nextStep = function() {\n    var x, y, _ref;\n    if (this.open.length === 0) {\n      this.isFinished = true;\n      return;\n    }\n    _ref = this.iToC(this.open.shift()), x = _ref[0], y = _ref[1];\n    this.closeNode(x, y);\n    return this.addNeighbors(x, y);\n  };\n\n  Pathfinder.prototype.addNeighbors = function(x, y) {\n    var index;\n    index = this.data[this.cToI(x, y)].index;\n    this.addOpen(x + 1, y, index);\n    x - 1 >= 0 && this.addOpen(x - 1, y, index);\n    this.addOpen(x, y + 1, index);\n    y - 1 >= 0 && this.addOpen(x, y - 1, index);\n  };\n  // 访问到这个节点\n  Pathfinder.prototype.addOpen = function(x, y, nodeIndex) {\n    var index, node, tX, tY, _ref;\n    if(x < 0 || x > this.width - 1 || y < 0 || y > this.height - 1) return;\n    index = this.cToI(x, y);\n    // console.log(x, y)\n    node = this.data[index];\n    // console.log(node)\n    if (node.open) {\n      this.open.push(index);\n      node.fromIndex = nodeIndex;\n      node.open = false;\n      node.visited = true;\n    }\n    _ref = this.targetPosition, tX = _ref[0], tY = _ref[1];\n    if (x === tX && y === tY) {\n      return this.targetFound();\n    }\n  };\n\n  Pathfinder.prototype.closeNode = function(x, y) {\n    var node;\n    node = this.data[this.cToI(x, y)];\n    try {\n      node.open = false;\n    } catch (err) {\n      console.log(this);\n      console.log(x, y);\n    }\n\n  };\n\n  Pathfinder.prototype.targetFound = function() {\n    var _results;\n    this.isFinished = true;\n    this.solutionPath = [];\n    this.solutionPath.push(this.targetPosition);\n    _results = [];\n\n    while (this.walkSolution()) {\n      _results.push(true);\n    }\n    return _results;\n  };\n\n  Pathfinder.prototype.pathFound = function() {\n    var path;\n    path = this.solutionPath.reverse();\n    this.path = path.slice(1);\n    this.foundCallback && this.foundCallback(path);\n  };\n\n  Pathfinder.prototype.walkSolution = function() {\n    var lastNode, nextNode, _ref;\n    _ref = this.solutionPath[this.solutionPath.length - 1];\n    let [x, y] = _ref;\n    lastNode = this.data[this.cToI(x, y)];\n    try { \n      nextNode = this.data[lastNode.fromIndex];\n      this.solutionPath.push([nextNode.x, nextNode.y]);\n      if (!nextNode.fromIndex) {\n        this.isFinished = true;\n        this.pathFound();\n        return false;\n      }\n    } catch(err) {\n      throw(err);\n    }\n\n    // console.log(nextNode.index);\n    return true;\n  };\n\n  Pathfinder.prototype.findLowestNeighbor = function(x, y) {\n    var candidateNode, node;\n    candidateNode = this.data[this.cToI(x, y)];\n    node = this.data[this.cToI(x + 1, y)];\n    if (node && node.visited && node.index < candidateNode.index) {\n      candidateNode = node;\n    }\n    node = this.data[this.cToI(x - 1, y)];\n    if (node && node.visited && node.index < candidateNode.index) {\n      candidateNode = node;\n    }\n    node = this.data[this.cToI(x, y + 1)];\n    if (node && node.visited && node.index < candidateNode.index) {\n      candidateNode = node;\n    }\n    node = this.data[this.cToI(x, y - 1)];\n    if (node && node.visited && node.index < candidateNode.index) {\n      candidateNode = node;\n    }\n    return candidateNode;\n  };\n\n  Pathfinder.prototype.reset = function() {\n    this.open = [];\n    this.data = this.parseGridData();\n    this.isFinished = false;\n    return ;\n  };\n  // 列转换成idx\n  Pathfinder.prototype.cToI = function(x, y) {\n    return y * this.width + x;\n  };\n  // idx转换成坐标\n  Pathfinder.prototype.iToC = function(index) {\n    var x, y;\n    x = index % this.width;\n    y = Math.floor(index / this.width);\n    return [x, y];\n  };\n\n  return Pathfinder;\n\n})();\nmodule.exports =  Pathfinder;","import wImg from './img/wolf.png';\nimport sImg from './img/sheep.png';\n\nlet msg = document.getElementById('message');\nlet avatar = msg.querySelector('img');\nlet content = msg.querySelector('div');\nfunction show(who, word) {\n  avatar.src = who === 'wolf' ? wImg : sImg;\n  content.textContent = word;\n  msg.classList.add('show');\n  setTimeout(() => msg.classList.remove('show'), 2000);\n}\nexport default show;","import Pathfinder from './search';\nimport msg from './message';\nfunction sameLocation(a, b) {\n  return a.x === b.x && a.y === b.y;\n}\nfunction rand(min, max) {\n  return min + Math.floor((max-min) * Math.random());\n}\nlet wolfImg = document.getElementById('wolf-img');\nclass Wolf{\n  constructor(x = 0, y = 0, size = window.CELL_W) {\n    this.x = x;\n    this.y = y;\n    this.speed = Wolf.wolves.length ? rand(2, 4) : 2;\n    this.size = size;\n    this.isCallHelped = false;\n    this.stuck = 0;\n\n    this._timeStamp = Date.now();\n  }\n  //狼的绘制和运动代码\n  draw() {\n    let context = window.context;\n    context.save();\n    context.drawImage(wolfImg, this.x, this.y, this.size, this.size);\n    // context.fillStyle = \"#39A234\";\n    // context.beginPath();\n    // var p0x = this.x + 10;\n    // var p0y = this.y + 10;\n    // var size = this.size;\n    // context.moveTo(p0x + size, p0y);\n    // for (var i = 1; i < 6; i++) {\n    //     context.lineTo(p0x + size * Math.cos(Math.PI / 3 * i), p0y - size * Math.sin(Math.PI / 3 * i));\n    // }\n    // context.closePath();\n    // context.fill();\n    context.restore();\n  }\n\n  move() {\n      let now = Date.now();\n      if (now - this._timeStamp < 1000 / this.speed) return;\n      this._timeStamp = now;\n      if (sameLocation(this, window.sheep)) {\n          msg('wolf', '哈哈哈，你被抓住了');\n          window.gameOver = true;\n          return;\n      }\n      if (!this.path) {\n          let sheep = window.sheep;\n          let pathFinder = new Pathfinder(window.gridData, [(sheep.x)/window.CELL_W, (sheep.y)/window.CELL_W]);\n          pathFinder.beginFill(this);\n          if (pathFinder.path) {\n              this.path = pathFinder.path;\n          }\n      }\n      if (this.path) {\n          this.size = window.CELL_W;\n          this.stuck = 0;\n          let point = this.path.shift();\n          if (point) {\n              this.x = point[0] * window.CELL_W;\n              this.y = point[1] * window.CELL_W;\n          } else {\n              this.path = null;\n          }\n      } else {\n          this.size = this.size === window.CELL_W ? window.CELL_W * 1.2 : window.CELL_W;\n          if (this.stuck === 1) {\n            let msgs = [\n              '你等着，我叫人去',\n              '我大哥来了你就死定了',\n              '我们老大马上就到',\n              '额，是个狠人',\n              '大大大大，大哥别杀我~'\n            ];\n            msg('wolf', msgs[Wolf.wolves.length-1]);\n          }\n          this.stuck++;\n          if (this.stuck > 6 && !this.isCallHelped) {\n            Wolf.callHelp();\n            this.isCallHelped = true;\n          }\n      }\n  }\n\n  static callHelp() {\n    if (Wolf.wolves.length > 4) {\n      msg('sheep', '我们赢了！');\n      return;\n    }\n    // TODO: 利用pathFinder，优化狼出现的位置\n    let pf = new Pathfinder(window.gridData, [0,0]);\n    let {x, y} = window.sheep;\n    let wolf;\n    pf.findSteps([x / window.CELL_W, y / window.CELL_W], 8);\n    let targetPoint = pf.data[pf.open.pop()];\n    if (!targetPoint) {\n      pf.findSteps([x / window.CELL_W, y / window.CELL_W], 2);\n      targetPoint = pf.data[pf.open.pop()];\n    }\n    wolf = new Wolf(targetPoint.x * window.CELL_W, targetPoint.y * window.CELL_W);\n    Wolf.wolves.push(wolf);\n  }\n}\nWolf.wolves = [];\nexport default Wolf;","/**\n * Created by gg on 2016/9/7.\n */\nimport Wolf from \"./wolf\";\nlet can = document.getElementById(\"game\"),\n  context = can.getContext(\"2d\"),\n  can2 = document.getElementById(\"bg\"),\n  ctx = can2.getContext(\"2d\");\nconst GRID_NUM = 25; // 20 25\n\nlet CELL_W;\n\nlet walls = [],\n  wolves = Wolf.wolves;\nwindow.context = context;\nlet sheep = {\n  x: 0,\n  y: 0,\n  draw() {\n    context.drawImage(sheepImg, this.x, this.y, CELL_W, CELL_W);\n  },\n  init() {\n    this.x = this.y = can.width - CELL_W;\n  }\n};\n\nwindow.sheep = sheep;\n\nlet gameOver = (window.gameOver = false);\nlet wolf = new Wolf(0, 0);\nwolves.push(wolf);\nwindow.gridData = Array(GRID_NUM)\n  .fill()\n  .map(() => Array(GRID_NUM).fill(0));\n// 画网格\nfunction drawGrid(color, stepx, stepy) {\n  ctx.save();\n  ctx.strokeStyle = color;\n  ctx.lineWidth = 0.5;\n  ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n\n  for (var i = stepx + 0.5; i < ctx.canvas.width; i += stepx) {\n    ctx.beginPath();\n    ctx.moveTo(i, 0);\n    ctx.lineTo(i, ctx.canvas.height);\n    ctx.stroke();\n  }\n\n  for (var i = stepy + 0.5; i < ctx.canvas.height; i += stepy) {\n    ctx.beginPath();\n    ctx.moveTo(0, i);\n    ctx.lineTo(ctx.canvas.width, i);\n    ctx.stroke();\n  }\n\n  ctx.restore();\n}\n// 砖块\nclass Block {\n  constructor(x, y) {\n    //创建砖块\n    this.x = x;\n    this.y = y;\n  }\n  draw() {\n    context.save();\n    context.fillRect(this.x + 1, this.y + 1, CELL_W - 1, CELL_W - 1);\n    // context.drawImage(brickImg, this.x, this.y, CELL_W, CELL_W);\n    context.restore();\n  }\n}\n\nfunction wallsInit() {\n  for (var i = CELL_W * 4; i < can.width - CELL_W * 4; i += CELL_W) {\n    for (var j = CELL_W * 4; j < can.width - CELL_W * 4; j += CELL_W) {\n      if (!(i > 200 && i < 280 && (j > 200 && j < 280))) {\n        //留下中间3*3个空格\n        walls.push(new Block(i, j));\n        window.gridData[i / CELL_W][j / CELL_W] = 1;\n      }\n    }\n  }\n}\n//画出墙\nfunction wallsDraw() {\n  context.fillStyle = \"rgba(255,165,0,0.5)\";\n  walls.forEach(function(wall) {\n    wall.draw();\n  });\n}\n\n//墙的运动\nfunction wallLine(direction) {\n  //选出羊上面的砖块\n  var wallLine = [];\n  let len = walls.length;\n  switch (direction) {\n    case \"up\":\n      for (var i = 0; i < len; i++) {\n        if (walls[i].x == sheep.x && walls[i].y <= sheep.y) {\n          wallLine.push(walls[i]);\n        }\n      }\n      break;\n    case \"down\":\n      for (var i = 0; i < len; i++) {\n        if (walls[i].x == sheep.x && walls[i].y >= sheep.y) {\n          wallLine.push(walls[i]);\n        }\n      }\n      break;\n    case \"left\":\n      for (var i = 0; i < len; i++) {\n        if (walls[i].y == sheep.y && walls[i].x <= sheep.x) {\n          wallLine.push(walls[i]);\n        }\n      }\n      break;\n    case \"right\":\n      for (var i = 0; i < len; i++) {\n        if (walls[i].y == sheep.y && walls[i].x >= sheep.x) {\n          wallLine.push(walls[i]);\n        }\n      }\n      break;\n  }\n  return wallLine;\n}\n\n// 返回需要移动的砖块\nfunction wallAffect(dir, wl) {\n  var wallToMove = [],\n    wl = wl || wallLine(dir),\n    pointer; //羊运动影响的砖块集合,edge检测边界\n  switch (dir) {\n    case \"up\":\n      {\n        pointer = sheep.y;\n        wl.sort((a, b) => a.y - b.y);\n        for (var j = wl.length - 1; j >= 0; j--) {\n          if (pointer - wl[j].y == CELL_W) {\n            wallToMove.push(wl[j]);\n            pointer = wl[j].y;\n          }\n        }\n      }\n      break;\n    case \"down\":\n      {\n        pointer = sheep.y;\n        wl.sort((a, b) => a.y - b.y);\n        for (var j = 0; j < wl.length; j++) {\n          if (wl[j].y - pointer == CELL_W) {\n            wallToMove.push(wl[j]);\n            pointer = wl[j].y;\n          }\n        }\n      }\n      break;\n    case \"left\":\n      {\n        pointer = sheep.x;\n        wl.sort((a, b) => a.x - b.x);\n        for (var k = wl.length - 1; k >= 0; k--) {\n          if (pointer - wl[k].x == CELL_W) {\n            wallToMove.push(wl[k]);\n            pointer = wl[k].x;\n          }\n        }\n      }\n      break;\n    case \"right\":\n      {\n        pointer = sheep.x;\n        wl.sort((a, b) => a.x - b.x);\n        for (var m = 0; m < wl.length; m++) {\n          if (wl[m].x - pointer == CELL_W) {\n            wallToMove.push(wl[m]);\n            pointer = wl[m].x;\n          }\n        }\n      }\n      break;\n  }\n  return wallToMove;\n}\n\nfunction sheepMove(e) {\n  let direction, moveBlocks;\n  if (typeof e === \"string\") {\n    direction = e;\n  } else {\n    var keyID = e.keyCode ? e.keyCode : e.which;\n    e.preventDefault();\n    direction = getDirection(keyID);\n  }\n  moveBlocks = wallAffect(direction);\n  function getDirection(keyID) {\n    if (keyID === 38 || keyID === 87) {\n      return \"up\";\n    }\n    if (keyID === 39 || keyID === 68) {\n      return \"right\";\n    }\n    if (keyID === 40 || keyID === 83) {\n      return \"down\";\n    }\n    if (keyID === 37 || keyID === 65) {\n      return \"left\";\n    }\n  }\n\n  function isWolfInTheWay(direction) {\n    let len = moveBlocks.length;\n    if (len === 0) return false;\n\n    let lastBlock = moveBlocks[len - 1];\n    if (direction === \"up\") {\n      return lastBlock.x === wolf.x && lastBlock.y - CELL_W === wolf.y;\n    }\n    if (direction === \"down\") {\n      return lastBlock.x === wolf.x && lastBlock.y + CELL_W === wolf.y;\n    }\n    if (direction === \"left\") {\n      return lastBlock.y === wolf.y && lastBlock.x - CELL_W === wolf.x;\n    }\n    if (direction === \"right\") {\n      return lastBlock.y === wolf.y && lastBlock.x + CELL_W === wolf.x;\n    }\n  }\n\n  if (direction === \"up\") {\n    // up arrow and W\n    if (sheep.y === 0) return;\n    moveBlocks = wallAffect(\"up\");\n    if (moveBlocks.every(e => e.y > 0) && !isWolfInTheWay(\"up\")) {\n      moveBlocks.forEach(ele => (ele.y -= CELL_W));\n      sheep.y = sheep.y - CELL_W;\n    }\n  }\n  if (direction === \"right\") {\n    // right arrow and D\n    if (sheep.x === can.width - CELL_W) return;\n    if (\n      moveBlocks.every(e => e.x < can.width - CELL_W) &&\n      !isWolfInTheWay(\"right\")\n    ) {\n      moveBlocks.forEach(ele => (ele.x += CELL_W));\n      sheep.x = sheep.x + CELL_W;\n    }\n  }\n  if (direction === \"down\") {\n    // down arrow and S\n    if (sheep.y === can.width - CELL_W) return;\n    if (\n      moveBlocks.every(e => e.y < can.height - CELL_W) &&\n      !isWolfInTheWay(\"down\")\n    ) {\n      moveBlocks.forEach(function(ele) {\n        ele.y += CELL_W;\n      });\n      sheep.y = sheep.y + CELL_W;\n    }\n  }\n  if (direction === \"left\") {\n    // left arrow and A\n\n    if (sheep.x === 0) return;\n    if (moveBlocks.every(e => e.x > 0) && !isWolfInTheWay(\"left\")) {\n      moveBlocks.forEach(function(ele) {\n        ele.x -= CELL_W;\n      });\n      sheep.x = sheep.x - CELL_W;\n    }\n  }\n  window.gridData = Array(GRID_NUM)\n    .fill()\n    .map(() => Array(GRID_NUM).fill(0));\n  walls.forEach(w => (window.gridData[w.y / CELL_W][w.x / CELL_W] = 1));\n  wolves.forEach(wolf => (wolf.path = null));\n}\n\nfunction loop() {\n  context.clearRect(0, 0, can.width, can.height);\n  wallsDraw();\n  sheep.draw();\n  wolves.forEach(wolf => {\n    wolf.move();\n    wolf.draw();\n  });\n  !window.gameOver && requestAnimationFrame(loop);\n}\n\nfunction main() {\n  var devicePixelRatio = window.devicePixelRatio || 1,\n    backingStoreRatio =\n      context.webkitBackingStorePixelRatio ||\n      context.mozBackingStorePixelRatio ||\n      context.msBackingStorePixelRatio ||\n      context.oBackingStorePixelRatio ||\n      context.backingStorePixelRatio ||\n      1,\n    ratio = devicePixelRatio / backingStoreRatio;\n  var isMobile = navigator.userAgent.match(\n    /(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i\n  );\n  [can, can2].map(function(canvas) {\n    var oldWidth = canvas.width;\n    var oldHeight = canvas.height;\n    canvas.width = oldWidth * ratio;\n    canvas.height = oldHeight * ratio;\n    if (isMobile) {\n      canvas.style.width = \"100vw\";\n      canvas.style.height = \"100vw\";\n    } else {\n      canvas.style.width = oldWidth + \"px\";\n      canvas.style.height = oldHeight + \"px\";\n    }\n    // canvas.getContext('2d').scale(ratio, ratio);\n    CELL_W = canvas.width / GRID_NUM;\n    window.CELL_W = CELL_W;\n  });\n  // 滑动操作代码\n  // if (isMobile) {\n  //   var gamepad = window.nipplejs.create({\n  //     zone: document.getElementById(\"static\"),\n  //     mode: \"static\",\n  //     position: { left: \"50%\", top: \"80%\" },\n  //     color: \"red\"\n  //   });\n  //   let timer;\n  //   gamepad.on(\"dir\", function(ev, data) {\n  //     console.log(data.direction.angle);\n  //     clearInterval(timer);\n  //     timer = setInterval(function() {\n  //       sheepMove(data.direction.angle);\n  //     }, 100);\n  //   });\n  //   gamepad.on(\"end\", function() {\n  //     clearInterval(timer);\n  //   });\n  // }\n\n  wallsInit();\n  sheep.init();\n  drawGrid(\n    \"rgba(100,100,100,0.3)\",\n    Math.floor(can.width / GRID_NUM),\n    Math.floor(can.height / GRID_NUM)\n  );\n  document.addEventListener(\"keydown\", sheepMove);\n  document\n    .querySelector(\".keyboard\")\n    .addEventListener(\"touchstart\", function(e) {\n      e.stopPropagation();\n      e.preventDefault();\n      sheepMove(e.target.id);\n    });\n  loop();\n}\nlet wolfImg = document.getElementById(\"wolf-img\");\nlet sheepImg = document.getElementById(\"sheep-img\");\nlet promiseArr = [sheepImg, wolfImg].map(\n  el =>\n    new Promise(function(resolve, reject) {\n      el.onload = function() {\n        console.log(\"load\", el);\n        resolve();\n      };\n    })\n);\n// Promise.all(promiseArr).then((v) => {\n//     main();\n// }).catch(err => console.log(err));\nmain();\n"]}